---
import { Icon } from "astro-icon/components";

const navLinks = [
    { name: "#home", href: "/" },
    { name: "#works", href: "/projects" },
    { name: "#about-me", href: "/#about" },
    { name: "#skills", href: "/skills" },
    { name: "#contacts", href: "/contact" },
];
---

<header
    id="main-header"
    class="w-full py-6 md:py-8 z-50 sticky top-0 transition-all duration-300"
>
    <div class="container-custom flex justify-between items-center">
        <!-- Logo -->
        <a
            href="/"
            class="flex items-center gap-2 font-bold text-white text-lg hover:opacity-80 transition-opacity"
        >
            <Icon name="mdi:code-braces" class="w-6 h-6 text-accent-violet" />
            <span>Paul</span>
        </a>

        <!-- Desktop Menu -->
        <nav class="hidden md:flex items-center gap-8">
            <a
                href="/"
                class="text-text-muted hover:text-white transition-colors font-mono text-sm"
            >
                <span data-i18n="nav.home"></span>
            </a>
            <a
                href="/projects"
                class="text-text-muted hover:text-white transition-colors font-mono text-sm"
            >
                <span data-i18n="nav.works"></span>
            </a>
            <a
                href="/#about"
                class="text-text-muted hover:text-white transition-colors font-mono text-sm"
            >
                <span data-i18n="nav.about"></span>
            </a>
            <a
                href="/skills"
                class="text-text-muted hover:text-white transition-colors font-mono text-sm"
            >
                <span data-i18n="nav.skills"></span>
            </a>
            <a
                href="/contact"
                class="text-text-muted hover:text-white transition-colors font-mono text-sm"
            >
                <span data-i18n="nav.contacts"></span>
            </a>

            <div
                class="flex items-center gap-4 border-l border-text-muted/20 pl-4 ml-4"
            >
                <button
                    class="lang-toggle flex items-center gap-1 text-text-muted font-mono text-sm hover:text-white transition-colors cursor-pointer"
                >
                    <span class="lang-text">ES</span>
                    <Icon name="mdi:chevron-down" class="w-4 h-4" />
                </button>
            </div>
        </nav>

        <!-- Mobile Button -->
        <button id="mobile-menu-btn" class="md:hidden text-white p-2">
            <Icon name="mdi:menu" class="w-8 h-8" />
        </button>
    </div>

    <!-- Mobile Menu Overlay -->
    <div
        id="mobile-menu"
        class="fixed inset-0 bg-bg-dark z-40 transform translate-x-full transition-transform duration-300 md:hidden flex flex-col p-8"
    >
        <div class="flex justify-between items-center mb-12">
            <a
                href="/"
                class="flex items-center gap-2 font-bold text-white text-lg"
            >
                <Icon
                    name="mdi:code-braces"
                    class="w-6 h-6 text-accent-violet"
                />
                <span>Paul</span>
            </a>
            <div class="flex items-center gap-4">
                <button id="close-menu-btn" class="text-white p-2">
                    <Icon name="mdi:close" class="w-8 h-8" />
                </button>
            </div>
        </div>

        <nav class="flex flex-col gap-8 text-2xl">
            <a
                href="/"
                class="text-text-muted hover:text-white transition-colors font-mono mobile-link"
            >
                <span data-i18n="nav.home"></span>
            </a>
            <a
                href="/projects"
                class="text-text-muted hover:text-white transition-colors font-mono mobile-link"
            >
                <span data-i18n="nav.works"></span>
            </a>
            <a
                href="/#about"
                class="text-text-muted hover:text-white transition-colors font-mono mobile-link"
            >
                <span data-i18n="nav.about"></span>
            </a>
            <a
                href="/skills"
                class="text-text-muted hover:text-white transition-colors font-mono mobile-link"
            >
                <span data-i18n="nav.skills"></span>
            </a>
            <a
                href="/contact"
                class="text-text-muted hover:text-white transition-colors font-mono mobile-link"
            >
                <span data-i18n="nav.contacts"></span>
            </a>
        </nav>

        <div class="mt-auto flex gap-4 justify-center">
            <a href="#" class="text-text-muted hover:text-white">
                <Icon name="fa-brands:github" class="w-8 h-8" />
            </a>
            <a href="#" class="text-text-muted hover:text-white">
                <Icon name="fa-brands:linkedin" class="w-8 h-8" />
            </a>
        </div>
    </div>
</header>

<script>
    const menuBtn = document.getElementById("mobile-menu-btn");
    const closeBtn = document.getElementById("close-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const links = document.querySelectorAll(".mobile-link");
    const header = document.getElementById("main-header");

    function toggleMenu() {
        mobileMenu?.classList.toggle("translate-x-full");
        document.body.classList.toggle("overflow-hidden");
    }

    menuBtn?.addEventListener("click", toggleMenu);
    closeBtn?.addEventListener("click", toggleMenu);

    links.forEach((link) => {
        link.addEventListener("click", toggleMenu);
    });

    // Scroll animation for navbar with progressive line
    function handleScroll() {
        const scrollY = window.scrollY;
        const documentHeight =
            document.documentElement.scrollHeight - window.innerHeight;
        const scrollProgress =
            documentHeight > 0 ? (scrollY / documentHeight) * 100 : 0;

        // Reset step classes
        header?.classList.remove(
            "line-step-1",
            "line-step-2",
            "line-step-3",
            "line-step-4",
        );

        // Activate effects with minimal scroll (10px)
        if (scrollY > 10) {
            header?.classList.add("navbar-scrolled");

            // Calculate step based on scroll progress
            if (scrollProgress >= 75) {
                header?.classList.add("line-step-4"); // 100% width
            } else if (scrollProgress >= 50) {
                header?.classList.add("line-step-3"); // 75% width
            } else if (scrollProgress >= 25) {
                header?.classList.add("line-step-2"); // 50% width
            } else {
                header?.classList.add("line-step-1"); // 25% width
            }
        } else {
            header?.classList.remove("navbar-scrolled");
        }
    }

    window.addEventListener("scroll", handleScroll);
    handleScroll(); // Check initial state
</script>
